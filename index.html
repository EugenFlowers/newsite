<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мой встроенный браузер</title>
    <style>
        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #address-bar {
            padding: 8px;
            background: #f0f0f0;
            border-bottom: 1px solid #ccc;
        }
        #url-input {
            width: 70%;
            padding: 6px 8px;
            font-size: 14px;
        }
        #go-btn {
            padding: 6px 14px;
            font-size: 14px;
            background: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        #go-btn:hover {
            background: #0056b3;
        }
        #iframe-container {
            flex: 1;
        }
        #browser-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <div id="address-bar">
        <input type="url" id="url-input"
               value="https://netangels.ru/?p_ref=u120620"
               placeholder="Введите URL">
        <button id="go-btn">Перейти</button>
    </div>

    <div id="iframe-container">
        <!--
          ВАЖНО:
          - allow-popups: даём сайту право вызывать window.open/target="_blank".[web:53][web:58]
          - allow-scripts, allow-same-origin, allow-forms — для нормальной работы.[web:6]
          - БЕЗ allow-top-navigation(-by-user-activation), чтобы сайт не мог выкинуть пользователя из iframe в верхнее окно.
        -->
        <iframe
            id="browser-frame"
            src="https://netangels.ru/?p_ref=u120620"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
        ></iframe>
    </div>
</div>

<script>
    const iframe = document.getElementById('browser-frame');
    const urlInput = document.getElementById('url-input');
    const goBtn = document.getElementById('go-btn');

    function normalizeUrl(url) {
        if (!url) return '';
        url = url.trim();
        if (!url) return '';
        if (!/^https?:\/\//i.test(url)) {
            url = 'https://' + url;
        }
        return url;
    }

    function navigate(url) {
        const u = normalizeUrl(url);
        if (!u) return;
        iframe.src = u;
        urlInput.value = u;
    }

    goBtn.addEventListener('click', () => navigate(urlInput.value));
    urlInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') navigate(urlInput.value);
    });

    // 1) Пытаемся перехватить window.open внутри iframe (работает только при same-origin)
    function tryOverrideWindowOpen() {
        try {
            const w = iframe.contentWindow;
            if (!w) return;

            const originalOpen = w.open;

            w.open = function (url, target, features) {
                if (url) {
                    // "Новое окно" открываем в том же iframe
                    const finalUrl = normalizeUrl(url);
                    if (finalUrl) {
                        iframe.src = finalUrl;
                        urlInput.value = finalUrl;
                    }
                    // возвращаем контент iframe как «окно»
                    return iframe.contentWindow || null;
                }
                // fallback — ведём себя как оригинальный window.open
                return originalOpen.call(w, url, target, features);
            };
        } catch (e) {
            // cross-origin — доступ к contentWindow запрещён, переопределить нельзя.[web:41][web:48]
        }
    }

    // 2) Пытаемся поймать target="_blank" через поддержку браузера
    // Часть браузеров, если sandbox + allow-popups, всё равно блокируют popups
    // или открывают их как новые вкладки; полностью перехватить это нельзя.[web:53][web:59]
    iframe.addEventListener('load', () => {
        tryOverrideWindowOpen();
    });
</script>
</body>
</html>










